{
  "name": "{{ app_name }}",
  "repo_name": "{{ app_name }}",
  "project_type": "python",
  "aws_region": "us-east-1",
  "runtime": {
    "language": "python",
    "version": "{{ python_version }}"
  },
  "build": {
    "commands": [
      "echo 'Setting up Python environment'",
      "python -m pip install --upgrade pip",
      "pip install -r requirements.txt",
      "echo 'Running tests with coverage'",
      "python -m pytest tests/ --cov=app --cov-report=xml --cov-report=html",
      "echo 'Running linting checks'",
      "flake8 app/ tests/",
      "black --check app/ tests/",
      "echo 'Building Docker image'",
      "docker build -t {{ app_name }}:latest ."
    ],
    "artifacts": {
      "files": ["Dockerfile", "requirements.txt", "app/**/*"],
      "base-directory": ".",
      "name": "python-api-artifacts"
    },
    "cache": {
      "paths": ["/root/.cache/pip/**/*"]
    }
  },
  "test": {
    "enabled": true,
    "commands": [
      "python -m pytest tests/ -v",
      "python -m pytest tests/ --cov=app --cov-report=xml"
    ],
    "coverage": {
      "threshold": "{{ test_coverage_threshold }}",
      "reports": ["htmlcov/**/*", "coverage.xml"]
    }
  },
  "extra_stages": [],
  "deploy": {
    "type": "{{ deployment_type }}",
    "config": {
      "container_name": "{{ app_name }}",
      "container_port": "{{ container_port }}",
      "cpu": 256,
      "memory": 512,
      "desired_count": 2,
      "health_check_path": "/health",
      "environment_variables": {
        "APP_NAME": "{{ app_name }}",
        "PORT": "{{ container_port }}"
      }
    }
  },
  "environment_variables": {
    "PYTHON_ENV": "production",
    "APP_VERSION": "$CODEBUILD_BUILD_NUMBER",
    "BUILD_ID": "$CODEBUILD_BUILD_ID"
  },
  "notifications": {
    "enabled": true,
    "channels": ["email"],
    "events": ["pipeline_failed", "pipeline_succeeded", "deploy_completed", "test_failed"]
  }
}